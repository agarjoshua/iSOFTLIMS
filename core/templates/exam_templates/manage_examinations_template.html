{% extends 'admin_template/base_template.html' %}

{% block page_title %}
<h1 class="ml-3">Manage Examinations</h1>
{% endblock page_title %}

{% block main_content %}

{% load static %}


<section class="content">
    <div class="">

        {% if messages %}
        <div class="form-group">
            <div class="col-12">
                {% for message in messages %}
                {% if message.tags == "error" %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert" style="margin-top: 10px;">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                {% elif message.tags == "success" %}
                <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-top: 10px;">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                {% elif message.tags == "warning" %}
                <div class="alert alert-warning alert-dismissible fade show" role="alert" style="margin-top: 10px;">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="mx-4">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Exam Type</th>
                        <th>Exam Date</th>
                        <th>Compulsory</th>
                        <th>Exam Class</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for exam in exam%}
                    <tr>
                        <td contenteditable="true">{{ exam.name }}</td>
                        <td contenteditable="true">{{ exam.exam_type.name }}</td>
                        <td contenteditable="true">{{ exam.exam_date }}</td>
                        <td contenteditable="true">{{ exam.is_compulsory }}</td>
                        <td contenteditable="true">{{ exam.exam_class }}</td>
                        <td>
                            <button class="btn btn-primary" data-toggle="collapse" data-target="#form{{ exam.id }}">Add Details</button>
                            <button class="btn btn-button btn-success">Save</button>
                        </td>
                    </tr>
                    
                    <tr>
                        <td colspan="8">
                            <div id="form{{ exam.id }}" class="form-row collapse">
                                <div>
                                </div>
                                <div class="card col-md-6 my-3">
                                    <div class="container my-3">
                                        <h3 class="text-bold">Grading for the Examinations</h3>
                                        <div class="">
                                          <div class=" ">
                                            <table class="table table-striped">
                                              <thead>
                                                {% for i in grade_level_list%}
                                                    {% if i.exam == exam.id%}
                                                <tr>
                                                  <th></th>
                                                  <th>Grade</th>
                                                  <th>Min Score</th>
                                                  <th>Max Score</th>
                                                  <th>Action</th>
                                                </tr>
                                              </thead>
                                              <tbody>
                                                <tr>
                                                  <td></td>
                                                  <td contenteditable="true">{{i.grade}}</td>
                                                  <td contenteditable="true">{{i.max_score}}</td>
                                                  <td contenteditable="true">{{i.min_score}}</td>
                                                  <td>
                                                    <button class="btn btn-success save-row">Add</button>
                                                  </td>
                                                </tr>
                                                
                                                <tr>
                                                  <td>1</td> 
                                                  <td contenteditable="true">A</td>
                                                  <td contenteditable="true">90</td>
                                                  <td contenteditable="true">100</td>
                                                  <td>
                                                    <button class="btn btn-success edit-row">Save</button>
                                                    <button class="btn btn-danger delete-row">Delete</button>
                                                  </td>
                                                </tr>
                                              </tbody>
                                              {% endif %}
                                              {% endfor %}
                                            </table>
                                          </div>
                                        </div>
                                      </div>
                                  </div>
                                  
                                <div class="col-md-6 my-3">
                                    <div class="card rowss">
                                        <h3 class="mx-3 my-3 text-bold">Add Exam Type <h6 class="text-small">if type doesnt exist</h6></h3>
                                        
                                            <div class="mx-3">
                                                <div class=" my-3">
                                                    <div class="">

                                                        <form id="exam-type-form" method="POST" action="{% url 'add_exam_type' %}">
                                                            {% csrf_token %}

                                                                <div class="form-group">
                                                                  <label class="control-label col-sm-3">Exam Type Name:</label>
                                                                  <div class="col-sm-9">
                                                                    {{ exam_type_form.name }}
                                                                  </div>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label class="control-label col-sm-3">Exam Type Description:</label>
                                                                    <div class="col-sm-9">
                                                                      {{ exam_type_form.description }}
                                                                    </div>
                                                                  </div>
                                                                
                                                            <button type="submit" class="btn btn-primary">Submit</button>
                                                        </form>


                                                       <div  class="">

                                                        <table class="table table-striped">
                                                            <thead>
                                                              <tr>
                                                                <th>Exam Type Name</th>
                                                                <th>Exam Type Description</th>
                                                                <th></th>
                                                              </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for i in exam_type_list%}
                                                              <tr>
                                                                <td contenteditable="true">{{i.name}}</td>
                                                                <td contenteditable="true">{{i.description}}</td>
                                                                <td>
                                                                  <button type="button" class="btn btn-sm btn-primary mr-2">Edit</button>
                                                                  <button type="button" class="btn btn-sm btn-success mr-2">Save</button>
                                                                  <button type="button" class="btn btn-sm btn-danger">Delete</button>
                                                                </td>
                                                              </tr>
                                                              {% endfor %}
                                                            </tbody>
                                                          </table>
                                                       </div>

                                                    </div>
                                                </div>
                
                                            </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor%}
                </tbody>
            </table>
        </div>


        

    </div>


</section>

{% endblock main_content %}

{% block custom_js %}

{% comment %}
With these changes, the "Select All" button will check all checkboxes in the table, and only unchecked checkboxes will
be included in the mass edit action.
{% endcomment %}

<script>
    $(document).ready(function () {
        $('.card').removeClass('collapsed');

        $('[data-card-widget="my-custom-collapse"]').on('click', function () {
            // Toggle the card body collapse state
            $(this).closest('.card').find('.card-body').toggleClass('collapsed');
            // Toggle the button icon
            $(this).find('i').toggleClass('fas fa-minus fas fa-minus');
        });
        $('[data-card-widget="collapseRegister"]').on('click', function () {
            // Toggle the card body collapse state
            $(this).closest('.card').find('.register-card-body').toggleClass('collapsed');
            // Toggle the button icon
            $(this).find('i').toggleClass('fas fa-minus fas fa-minus');
        });
        $('[data-card-widget="collapseGradeRange"]').on('click', function () {
            // Toggle the card body collapse state
            $(this).closest('.card').find('.collapseGradeRange-card-body').toggleClass('collapsed');
            // Toggle the button icon
            $(this).find('i').toggleClass('fas fa-minus fas fa-minus');
        });
        $('[data-card-widget="collapseExamType"]').on('click', function () {
            // Toggle the card body collapse state
            $(this).closest('.card').find('.collapseExamType-card-body').toggleClass('collapsed');
            // Toggle the button icon
            $(this).find('i').toggleClass('fas fa-minus fas fa-minus');
        });
        $('[data-card-widget="collapseExamType"]').on('click', function () {
            // Toggle the card body collapse state
            $(this).closest('.card').find('.collapseExamType-card-body').toggleClass('collapsed');
            // Toggle the button icon
            $(this).find('i').toggleClass('fas fa-minus fas fa-minus');
        });
        $('[data-card-widget="collapseExamType"]').on('click', function () {
            // Toggle the card body collapse state
            $(this).closest('.card').find('.collapseExamType-card-body').toggleClass('collapsed');
            // Toggle the button icon
            $(this).find('i').toggleClass('fas fa-minus fas fa-minus');
        });
        $('[data-card-widget="collapseExamType"]').on('click', function () {
            // Toggle the card body collapse state
            $(this).closest('.card').find('.collapseExamType-card-body').toggleClass('collapsed');
            // Toggle the button icon
            $(this).find('i').toggleClass('fas fa-minus fas fa-minus');
        });

    });

    $(document).ready(function () {
        $('.btn').click(function () {
            $(this).siblings('.form-row').toggle();
        });
    });

    $(document).ready(function () {
        // Submit Exam form with AJAX
        $("#exam-form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/exam-submit/",
                data: $(this).serialize(),
                success: function (response) {
                    alert(response);
                    location.reload();
                },
                error: function (response) {
                    alert(response);
                }
            });
        });

        // Submit ExamType form with AJAX
        $("#exam-type-form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/exam-type-submit/",
                data: $(this).serialize(),
                success: function (response) {
                    alert(response);
                    location.reload();
                },
                error: function (response) {
                    alert(response);
                }
            });
        });

        // Submit GradeRange form with AJAX
        $("#grade-range-form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/grade-range-submit/",
                data: $(this).serialize(),
                success: function (response) {
                    alert(response);
                    location.reload();
                },
                error: function (response) {
                    alert(response);
                }
            });
        });

        // Submit ExamRegistration form with AJAX
        $("#exam-registration-form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/exam-registration-submit/",
                data: $(this).serialize(),
                success: function (response) {
                    alert(response);
                    location.reload();
                },
                error: function (response) {
                    alert(response);
                }
            });
        });

        // Submit ExamResult form with AJAX
        $("#exam-result-form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/exam-result-submit/",
                data: $(this).serialize(),
                success: function (response) {
                    alert(response);
                    location.reload();
                },
                error: function (response) {
                    alert(response);
                }
            });
        });

        // Submit Transcripts form with AJAX
        $("#transcripts-form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/transcripts-submit/",
                data: $(this).serialize(),
                success: function (response) {
                    alert(response);
                    location.reload();
                },
                error: function (response) {
                    alert(response);
                }
            });
        });
</script>

{% endblock custom_js %}